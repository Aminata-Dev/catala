## Article

```catala
declaration scope S:
  internal f content integer depends on y content integer
  input x content boolean
  output z content integer

scope S:
  definition f of y equals if x then y else - y
  definition z equals f of -1
```

```catala-test-inline
$ catala Lcalc -s S --avoid_exceptions -O --closure_conversion
let scope S (S_in: S_in {x_in: eoption bool}): S {z: eoption integer} =
  let get x : eoption bool = S_in.x_in in
  let set f :
      eoption
        (((eoption bool), integer) → eoption integer * (eoption bool)) =
    ESome
      let f : ((eoption bool), integer) → eoption integer =
        λ (env: (eoption bool)) (y: integer) →
        let x : eoption bool = env.0 in
        ESome
          match
            (match x with
             | ENone _ → ENone _
             | ESome x1 → if x1 then ESome y else ESome - y)
            with
          | ENone _ → raise NoValueProvided
          | ESome f → f
      in
      (f, (x))
  in
  let set z : eoption integer =
    ESome
      match
        (match f with
         | ENone _ → ENone _
         | ESome f →
           let code_and_env :
               (((eoption bool), integer) → eoption integer *
                 (eoption bool)) =
             f
           in
           let code : ((eoption bool), integer) → eoption integer =
             code_and_env.0
           in
           let env : (eoption bool) = code_and_env.1 in
           code env -1)
        with
      | ENone _ → raise NoValueProvided
      | ESome z → z
  in
  return { S z = z; }
```
